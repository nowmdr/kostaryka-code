# CLAUDE.md - –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ Kostaryka Trip Map

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ò—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞](#–∏—Å—Ö–æ–¥–Ω–∞—è-–∑–∞–¥–∞—á–∞)
3. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
6. [–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è](#–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)
7. [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
8. [–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ](#–¥–∞–ª—å–Ω–µ–π—à–µ–µ-—Ä–∞–∑–≤–∏—Ç–∏–µ)

---

## üìñ –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
**Kostaryka Trip Map** - —ç—Ç–æ WordPress –ø–ª–∞–≥–∏–Ω –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Å–∞–π—Ç–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –Ω–∞ Breakdance builder. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –ª–æ–∫–∞—Ü–∏–π –¥–ª—è Custom Post Type "Wyprawy" (–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è).

### –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å
–≠—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω —Å–æ–∑–¥–∞–Ω –ù–ï —Ç–æ–ª—å–∫–æ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã. –û–Ω —Å–ª—É–∂–∏—Ç **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π** —Å–∞–π—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç JavaScript, PHP –∏–ª–∏ AJAX —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

### –ü–æ—á–µ–º—É –ø–ª–∞–≥–∏–Ω, –∞ –Ω–µ —Ç–µ–º–∞?
1. WordPress + Breakdance headless mode –ù–ï –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å child theme
2. Plugin —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–µ–º—ã
3. –õ–µ–≥—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å
4. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ª—é–±—É—é –∫–∞—Å—Ç–æ–º–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ –±—É–¥—É—â–µ–º

---

## üéØ –ò–°–•–û–î–ù–ê–Ø –ó–ê–î–ê–ß–ê

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å–∞–π—Ç –Ω–∞ WordPress —Å:
- **Breakdance builder** –≤ headless —Ä–µ–∂–∏–º–µ (–±–µ–∑ —Ç–µ–º—ã)
- **Custom Post Type**: "Wyprawy" (slug: `oferta`)
- **ACF Pro** —Å repeater –ø–æ–ª–µ–º –¥–ª—è –ª–æ–∫–∞—Ü–∏–π

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–¥–µ:
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–æ—Å—Ç–æ–≤ CPT –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "PodglƒÖd" (–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä)
2. –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Breakdance popup
3. –í popup –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
   - **–°–ª–µ–≤–∞** (35%): —Å–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π —Å —Ñ–æ—Ç–æ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º
   - **–°–ø—Ä–∞–≤–∞** (65%): –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –ª–æ–∫–∞—Ü–∏–π
4. –ö–ª–∏–∫ –ø–æ –ª–æ–∫–∞—Ü–∏–∏ –≤ —Å–ø–∏—Å–∫–µ ‚Üí —Ñ–æ–∫—É—Å –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ –Ω–∞ –∫–∞—Ä—Ç–µ
5. –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å popup —Å —Ñ–æ—Ç–æ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Leaflet.js** –¥–ª—è –∫–∞—Ä—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **OpenStreetMap** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ API key)
- AJAX –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- Responsive design –¥–ª—è mobile
- –†–∞–±–æ—Ç–∞ —Å ACF repeater fields

---

## üõ†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –°–¢–ï–ö

### WordPress –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **WordPress**: 5.8+
- **PHP**: 7.4+
- **Breakdance Builder**: headless mode
- **ACF Pro**: –¥–ª—è custom fields

### Frontend –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **Leaflet.js**: 1.9.4 (–∫–∞—Ä—Ç—ã)
- **OpenStreetMap tiles**: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ç–∞–π–ª—ã –∫–∞—Ä—Ç
- **jQuery**: 3.7.1 (—É–∂–µ –≤ WordPress)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö ACF
```
Group: (–ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
‚îî‚îÄ‚îÄ Repeater: location (–í–ê–ñ–ù–û: —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ!)
    ‚îú‚îÄ‚îÄ Text: location_name
    ‚îú‚îÄ‚îÄ Textarea: location_description
    ‚îú‚îÄ‚îÄ Image: location_image
    ‚îú‚îÄ‚îÄ Number: location_latitude (-90 –¥–æ 90)
    ‚îî‚îÄ‚îÄ Number: location_longitude (-180 –¥–æ 180)
```

---

## üî® –ü–†–û–¶–ï–°–° –†–ê–ó–†–ê–ë–û–¢–ö–ò

### –≠—Ç–∞–ø 1: –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ - Child Theme ‚ùå

**–ß—Ç–æ –ø—Ä–æ–±–æ–≤–∞–ª–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ child theme —Å `functions.php` –∏ JS —Ñ–∞–π–ª–∞–º–∏
- –ü–æ–ø—ã—Ç–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—É –≤ WordPress

**–ü—Ä–æ–±–ª–µ–º–∞:**
WordPress –ø—Ä–∏ Breakdance –≤ headless —Ä–µ–∂–∏–º–µ –ù–ï –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∫–∞–∫—É—é —Ç–µ–º—É. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ—è–≤–ª—è–ª–∞—Å—å –æ—à–∏–±–∫–∞:
```
"Niekompletne motywy - Brak motywu nadrzƒôdnego"
```

–î–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è `index.php` –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `style.css` —Ç–µ–º–∞ **–Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞—Å—å**.

**–í—ã–≤–æ–¥:**
Child theme - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è Breakdance headless.

---

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ ‚úÖ

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å WordPress –ø–ª–∞–≥–∏–Ω –≤–º–µ—Å—Ç–æ —Ç–µ–º—ã.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–∞:**
```
kostaryka-trip-map/
‚îú‚îÄ‚îÄ kostaryka-trip-map.php    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω–∞
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îî‚îÄ‚îÄ trip-map.js       # JavaScript –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ readme.txt                # WordPress.org —Ñ–æ—Ä–º–∞—Ç
```

**–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω–∞** (`kostaryka-trip-map.php`):
- –ö–ª–∞—Å—Å `Kostaryka_Trip_Map` (Singleton pattern)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Leaflet.js –∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ JS
- AJAX endpoint `get_trip_locations`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (ACF)

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –†–ï–®–ï–ù–ò–Ø

### PHP (Backend) - kostaryka-trip-map.php

#### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞
```php
class Kostaryka_Trip_Map {
    private static $instance = null;
    
    public static function get_instance() { ... }
    private function __construct() { ... }
    private function init_hooks() { ... }
    
    // –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
    public function enqueue_scripts() { ... }
    public function get_trip_locations() { ... }
    private function format_locations($locations) { ... }
    public function check_dependencies() { ... }
}
```

#### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤
```php
public function enqueue_scripts() {
    // Leaflet CSS
    wp_enqueue_style('leaflet-css', 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css');
    
    // Leaflet JS
    wp_enqueue_script('leaflet-js', 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js');
    
    // –ù–∞—à —Å–∫—Ä–∏–ø—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç jQuery –∏ Leaflet)
    wp_enqueue_script('kostaryka-trip-map', 
        KOSTARYKA_TRIP_MAP_PLUGIN_URL . 'assets/js/trip-map.js',
        array('jquery', 'leaflet-js'),
        KOSTARYKA_TRIP_MAP_VERSION,
        true  // –≤ footer
    );
    
    // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JS
    wp_localize_script('kostaryka-trip-map', 'tripMapData', array(
        'ajaxUrl' => admin_url('admin-ajax.php'),
        'nonce' => wp_create_nonce('trip_map_nonce'),
        'pluginUrl' => KOSTARYKA_TRIP_MAP_PLUGIN_URL,
        'version' => KOSTARYKA_TRIP_MAP_VERSION
    ));
}
```

#### 3. AJAX Handler
```php
public function get_trip_locations() {
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ nonce (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
    check_ajax_referer('trip_map_nonce', 'nonce', false);
    
    // 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è trip_id
    $trip_id = intval($_POST['trip_id']);
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å—Ç–∞
    $post_status = get_post_status($trip_id);
    if (!$post_status || $post_status !== 'publish') {
        wp_send_json_error('Trip not found or not published');
    }
    
    // 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ACF
    $locations = get_field('location', $trip_id);
    
    // 5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    $formatted_locations = $this->format_locations($locations);
    
    // 6. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    wp_send_json_success($formatted_locations);
}
```

#### 4. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```php
private function format_locations($locations) {
    $formatted = array();
    
    foreach ($locations as $location) {
        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        $latitude = floatval($location['location_latitude']);
        $longitude = floatval($location['location_longitude']);
        
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ ACF)
        $image_url = '';
        if (is_array($location['location_image'])) {
            $image_url = $location['location_image']['url'];
        } elseif (is_numeric($location['location_image'])) {
            $image_url = wp_get_attachment_image_url($location['location_image'], 'medium');
        }
        
        $formatted[] = array(
            'name' => $location['location_name'] ?? '',
            'description' => $location['location_description'] ?? '',
            'image' => $image_url,
            'latitude' => $latitude,
            'longitude' => $longitude,
            'has_coordinates' => ($latitude !== null && $longitude !== null && $latitude !== 0 && $longitude !== 0)
        );
    }
    
    return $formatted;
}
```

---

### JavaScript (Frontend) - trip-map.js

#### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```javascript
(function($) {
    'use strict';

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let map = null;
    let markers = [];
    let markersLayer = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    $(document).ready(function() {
        initTripMapButtons();
    });

    // –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function initTripMapButtons() { ... }
    function handleButtonClick(e) { ... }
    function loadTripLocations(tripId) { ... }
    function renderLocationsList(locations) { ... }
    function initMap(locations) { ... }
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
    function showLoader() { ... }
    function showError(message) { ... }
    function createPopupContent(loc) { ... }
    function escapeHtml(text) { ... }

})(jQuery);
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ—Å—Ç–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!)

**–ü–†–û–ë–õ–ï–ú–ê:** –í Breakdance `%%ID%%` –≤ data-–∞—Ç—Ä–∏–±—É—Ç–∞—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–†–ï–®–ï–ù–ò–ï:** –ò–∑–≤–ª–µ–∫–∞—Ç—å ID –∏–∑ URL —Å–æ—Å–µ–¥–Ω–µ–π —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ REST API:

```javascript
function handleButtonClick(e) {
    e.preventDefault();
    
    const $button = $(this);
    
    // 1. –ù–∞—Ö–æ–¥–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç –≤ —Ç–æ–π –∂–µ –∫–∞—Ä—Ç–æ—á–∫–µ
    const $postLink = $button.closest('.bde-loop-item').find('a[href*="/oferta/"]');
    const postUrl = $postLink.attr('href');
    
    // 2. –ò–∑–≤–ª–µ–∫–∞–µ–º slug –∏–∑ URL
    // URL: https://site.com/oferta/klejnoty-kostaryki/
    // Slug: klejnoty-kostaryki
    const urlParts = postUrl.split('/').filter(Boolean);
    const postSlug = urlParts[urlParts.length - 1];
    
    // 3. –ü–æ–ª—É—á–∞–µ–º ID –ø–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ REST API
    $.ajax({
        url: '/wp-json/wp/v2/oferta',
        type: 'GET',
        data: {
            slug: postSlug,
            _fields: 'id'  // –¢–æ–ª—å–∫–æ ID –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        },
        success: function(posts) {
            if (posts && posts.length > 0) {
                const tripId = posts[0].id;
                loadTripLocations(tripId);  // –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞—Ü–∏–∏
            }
        }
    });
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–∞–¥–µ–∂–Ω–æ:**
- URL –ø–æ—Å—Ç–∞ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- REST API - —Å—Ç–∞–Ω–¥–∞—Ä—Ç WordPress
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Breakdance –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML –∏–∑–º–µ–Ω–∏—Ç—Å—è

#### 3. AJAX –∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞—Ü–∏–π
```javascript
function loadTripLocations(tripId) {
    $.ajax({
        url: tripMapData.ajaxUrl,
        type: 'POST',
        data: {
            action: 'get_trip_locations',
            trip_id: tripId,
            nonce: tripMapData.nonce
        },
        beforeSend: function() {
            showLoader();  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        },
        success: function(response) {
            if (response.success && response.data) {
                renderLocationsList(response.data);  // –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫
                initMap(response.data);              // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
            } else {
                showError(response.data);
            }
        },
        error: function(xhr, status, error) {
            showError('B≈ÇƒÖd po≈ÇƒÖczenia. Spr√≥buj ponownie.');
        }
    });
}
```

#### 4. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –ª–æ–∫–∞—Ü–∏–π
```javascript
function renderLocationsList(locations) {
    let html = '<div class="locations-wrapper">';
    
    locations.forEach(function(loc, index) {
        html += '<div class="location-item" data-index="' + index + '">';
        
        if (loc.image) {
            html += '<img src="' + loc.image + '" alt="' + escapeHtml(loc.name) + '">';
        }
        
        html += '<div class="location-content">';
        html += '<h3>' + escapeHtml(loc.name) + '</h3>';
        
        if (loc.description) {
            const shortDesc = loc.description.substring(0, 100);
            html += '<p class="location-desc">' + escapeHtml(shortDesc) + '...</p>';
        }
        
        html += '</div></div>';
    });
    
    html += '</div>';
    $('#locations-list').html(html);
    
    // Event handler –¥–ª—è –∫–ª–∏–∫–∞ –ø–æ –ª–æ–∫–∞—Ü–∏–∏
    $('.location-item').on('click', function() {
        const index = $(this).data('index');
        
        $('.location-item').removeClass('active');
        $(this).addClass('active');
        
        if (markers[index]) {
            markers[index].openPopup();
            map.setView(markers[index].getLatLng(), 10);
        }
    });
}
```

#### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã Leaflet
```javascript
function initMap(locations) {
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –∫–∞—Ä—Ç—É –µ—Å–ª–∏ –µ—Å—Ç—å
    if (map !== null) {
        map.remove();
        map = null;
    }
    markers = [];
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏–∏ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
    const locationsWithCoords = locations.filter(function(loc) {
        return loc.has_coordinates;
    });
    
    if (locationsWithCoords.length === 0) {
        $('#map-container').html('<p>Brak lokacji z wsp√≥≈Çrzƒôdnymi.</p>');
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
    map = L.map('map-container', {
        scrollWheelZoom: true,
        zoomControl: true
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19,
        minZoom: 2
    }).addTo(map);
    
    // –°–æ–∑–¥–∞–µ–º layer group –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
    markersLayer = L.layerGroup().addTo(map);
    
    // Bounds –¥–ª—è –∞–≤—Ç–æ–∑—É–º–∞
    const bounds = L.latLngBounds();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
    locationsWithCoords.forEach(function(loc, index) {
        const marker = L.marker([loc.latitude, loc.longitude])
            .bindPopup(createPopupContent(loc));
        
        marker.addTo(markersLayer);
        markers.push(marker);
        bounds.extend([loc.latitude, loc.longitude]);
    });
    
    // –ê–≤—Ç–æ–∑—É–º –Ω–∞ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
    if (locationsWithCoords.length > 0) {
        map.fitBounds(bounds, {
            padding: [50, 50],
            maxZoom: 12
        });
    }
    
    // Fix –¥–ª—è display issues
    setTimeout(function() {
        map.invalidateSize();
    }, 100);
}
```

---

### CSS - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Breakdance Popup

#### Breakdance —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
Popup (ID: 399 –∏–ª–∏ –¥—Ä—É–≥–æ–π)
‚îî‚îÄ‚îÄ Div
    ‚îú‚îÄ‚îÄ Class: popup-two-columns
    ‚îÇ
    ‚îú‚îÄ‚îÄ Div #1
    ‚îÇ   ‚îî‚îÄ‚îÄ ID: locations-list    ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
    ‚îÇ
    ‚îî‚îÄ‚îÄ Div #2
        ‚îî‚îÄ‚îÄ ID: map-container     ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
```

#### CSS —Å—Ç–∏–ª–∏ (–≤ Custom CSS popup)
```css
/* Container –¥–ª—è –¥–≤—É—Ö –∫–æ–ª–æ–Ω–æ–∫ */
.popup-two-columns {
    display: flex;
    gap: 20px;
    height: 600px;
    max-height: 80vh;
    padding: 20px;
}

/* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Å–ø–∏—Å–æ–∫ */
#locations-list {
    width: 35%;
    overflow-y: auto;
    padding-right: 10px;
}

/* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∫–∞—Ä—Ç–∞ */
#map-container {
    width: 65%;
    height: 100%;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #ddd;
}

/* –≠–ª–µ–º–µ–Ω—Ç –ª–æ–∫–∞—Ü–∏–∏ */
.location-item {
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #fff;
}

.location-item:hover {
    border-color: #2271b1;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.location-item.active {
    border-color: #2271b1;
    background: #f0f6fc;
}

/* Responsive */
@media (max-width: 768px) {
    .popup-two-columns {
        flex-direction: column;
    }
    
    #locations-list,
    #map-container {
        width: 100%;
        height: 300px;
    }
}
```

---

### Breakdance –∫–Ω–æ–ø–∫–∞

#### HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–Ω–æ–ø–∫–∏
```html
<a class="trip-preview-btn" 
   href="#" 
   data-type="action" 
   data-action='{"type":"popup","popupOptions":{"popupId":"399","popupAction":"open"}}'>
    Click Here
</a>
```

**–í–∞–∂–Ω–æ:**
- Class: `trip-preview-btn` - –¥–ª—è JavaScript
- `data-action` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è Breakdance –∞–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è popup
- `popupId` - ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ popup (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Breakdance)

**–ù–ï –ù–£–ñ–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å `data-trip-id` - ID –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ URL!

---

## üêõ –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Child theme –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
```
"Niekompletne motywy - Brak motywu nadrzƒôdnego"
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Breakdance –≤ headless —Ä–µ–∂–∏–º–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–º—ã.

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω –≤–º–µ—Å—Ç–æ —Ç–µ–º—ã.

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: `tripMapData is not defined` ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
```javascript
Uncaught ReferenceError: tripMapData is not defined
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- Plugin –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- –ò–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ä–∞–Ω—å—à–µ —á–µ–º `wp_localize_script`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–ª–∞–≥–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω: **Wtyczki** ‚Üí "Kostaryka Trip Map" ‚Üí **Aktywna**
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ `enqueue_scripts()` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:
   ```php
   wp_enqueue_script('kostaryka-trip-map', ..., array('jquery', 'leaflet-js'), ..., true);
   wp_localize_script('kostaryka-trip-map', 'tripMapData', ...);
   ```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: `$ is not defined` ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
```javascript
Uncaught TypeError: Cannot read properties of undefined (reading 'ajax')
```

**–ü—Ä–∏—á–∏–Ω–∞:**
WordPress –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `jQuery.noConflict()`, –ø–æ—ç—Ç–æ–º—É `$` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:**
–û–±–µ—Ä–Ω—É—Ç—å –≤–µ—Å—å JS –∫–æ–¥ –≤:
```javascript
(function($) {
    'use strict';
    // –í–µ—Å—å –∫–æ–¥ –∑–¥–µ—Å—å, $ —Ä–∞–±–æ—Ç–∞–µ—Ç
})(jQuery);
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
console.log('jQuery version:', jQuery.fn.jquery);  // –†–∞–±–æ—Ç–∞–µ—Ç
console.log('$ defined:', typeof $ !== 'undefined');  // false (–≤ –≥–ª–æ–±–∞–ª–µ)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: AJAX –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "Trip not found" ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
```javascript
{success: false, data: 'Trip not found or not published'}
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID –ø–æ—Å—Ç–∞
2. –ü–æ—Å—Ç –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω (—Å—Ç–∞—Ç—É—Å –Ω–µ "publish")
3. ACF –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ - Debug:**
–î–æ–±–∞–≤–∏—Ç—å –≤ PHP (–≤—Ä–µ–º–µ–Ω–Ω–æ):
```php
public function get_trip_locations() {
    $trip_id = intval($_POST['trip_id']);
    $post_status = get_post_status($trip_id);
    $post_type = get_post_type($trip_id);
    
    // DEBUG
    if (!$post_status) {
        wp_send_json_error('Post does not exist. ID: ' . $trip_id);
        return;
    }
    
    if ($post_status !== 'publish') {
        wp_send_json_error('Post status is: ' . $post_status . ', type: ' . $post_type);
        return;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ ID –ø–æ—Å—Ç–∞:**
```javascript
// –í –∞–¥–º–∏–Ω–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞
// URL: /wp-admin/post.php?post=389&action=edit
//                              ^^^
//                           –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π ID
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: `%%ID%%` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
–í—Å–µ –∫–Ω–æ–ø–∫–∏ –∏–º–µ—é—Ç `data-trip-id="359"`, –Ω–æ —Ä–µ–∞–ª—å–Ω—ã–π ID –ø–æ—Å—Ç–∞ = 389.

**–ü—Ä–∏—á–∏–Ω–∞:**
Breakdance –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ `%%ID%%` –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ Query Loop.

**–†–ï–®–ï–ù–ò–ï (—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ):**
–ò–∑–≤–ª–µ–∫–∞—Ç—å ID –∏–∑ URL —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç:

```javascript
function handleButtonClick(e) {
    e.preventDefault();
    
    // 1. –ù–∞–π—Ç–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç
    const $postLink = $(this).closest('.bde-loop-item').find('a[href*="/oferta/"]');
    const postUrl = $postLink.attr('href');
    
    // 2. –ò–∑–≤–ª–µ—á—å slug
    const postSlug = postUrl.split('/').filter(Boolean).pop();
    
    // 3. –ü–æ–ª—É—á–∏—Ç—å ID —á–µ—Ä–µ–∑ REST API
    $.ajax({
        url: '/wp-json/wp/v2/oferta',
        data: { slug: postSlug, _fields: 'id' },
        success: function(posts) {
            const tripId = posts[0].id;
            loadTripLocations(tripId);
        }
    });
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- URL –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è WordPress)
- REST API —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö CPT
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Breakdance

---

### –ü—Ä–æ–±–ª–µ–º–∞ 6: REST API 404 –¥–ª—è CPT ‚ùå

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Failed to load resource: the server responded with a status of 404
/wp-json/wp/v2/oferta/389
```

**–ü—Ä–∏—á–∏–Ω–∞:**
CPT –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ REST API.

**–†–µ—à–µ–Ω–∏–µ:**
–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö CPT (ACF –∏–ª–∏ –∫–æ–¥) –≤–∫–ª—é—á–∏—Ç—å:
```
Advanced Settings ‚Üí Show in REST API: Yes
```

–ò–ª–∏ –≤ –∫–æ–¥–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ CPT:
```php
register_post_type('oferta', array(
    'show_in_rest' => true,  // ‚Üê –î–æ–±–∞–≤–∏—Ç—å
    // ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
));
```

---

## ‚úÖ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Plugin —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- ‚úÖ Leaflet.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ AJAX endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ ID –ø–æ—Å—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ URL —á–µ—Ä–µ–∑ REST API
- ‚úÖ –î–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–π –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ ACF
- ‚úÖ –ö–∞—Ä—Ç–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ª–µ–≤–∞
- ‚úÖ –ö–ª–∏–∫ –ø–æ –ª–æ–∫–∞—Ü–∏–∏ ‚Üí —Ñ–æ–∫—É—Å –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ
- ‚úÖ –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É ‚Üí popup —Å –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Responsive design —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ:
console.log(tripMapData);           // Object {ajaxUrl, nonce, ...}
console.log(typeof L);              // "object"
console.log(jQuery.fn.jquery);      // "3.7.1"
```

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
```javascript
jQuery.ajax({
    url: tripMapData.ajaxUrl,
    type: 'POST',
    data: {
        action: 'get_trip_locations',
        trip_id: 389,  // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π ID
        nonce: tripMapData.nonce
    },
    success: function(response) {
        console.log('Success:', response);
        // {success: true, data: Array(2)}
    }
});
```

---

## üöÄ –î–ê–õ–¨–ù–ï–ô–®–ï–ï –†–ê–ó–í–ò–¢–ò–ï

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π

–≠—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω —Å–æ–∑–¥–∞–Ω –∫–∞–∫ **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –±–∞–∑–∞** –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π —Å–∞–π—Ç–∞.

#### –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

**1. –ù–æ–≤—ã–µ AJAX endpoints:**
```php
// –í –∫–ª–∞—Å—Å–µ Kostaryka_Trip_Map
private function init_hooks() {
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ hooks
    add_action('wp_ajax_get_trip_locations', array($this, 'get_trip_locations'));
    
    // –ù–û–í–´–ô endpoint
    add_action('wp_ajax_custom_function', array($this, 'custom_function'));
    add_action('wp_ajax_nopriv_custom_function', array($this, 'custom_function'));
}

public function custom_function() {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
    wp_send_json_success($data);
}
```

**2. –ù–æ–≤—ã–µ JavaScript —Ñ–∞–π–ª—ã:**
```php
public function enqueue_scripts() {
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
    wp_enqueue_script('kostaryka-trip-map', ...);
    
    // –ù–û–í–´–ô —Å–∫—Ä–∏–ø—Ç
    wp_enqueue_script(
        'kostaryka-custom-feature',
        KOSTARYKA_TRIP_MAP_PLUGIN_URL . 'assets/js/custom-feature.js',
        array('jquery'),
        KOSTARYKA_TRIP_MAP_VERSION,
        true
    );
}
```

**3. –ù–æ–≤—ã–µ CSS —Å—Ç–∏–ª–∏:**
```php
public function enqueue_scripts() {
    // –ù–û–í–´–ô —Å—Ç–∏–ª—å
    wp_enqueue_style(
        'kostaryka-custom-styles',
        KOSTARYKA_TRIP_MAP_PLUGIN_URL . 'assets/css/custom-styles.css',
        array(),
        KOSTARYKA_TRIP_MAP_VERSION
    );
}
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
```
kostaryka-trip-map/
‚îú‚îÄ‚îÄ kostaryka-trip-map.php       # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ includes/                     # –ë—É–¥—É—â–∏–µ PHP –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ class-trip-map.php       # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ class-bookings.php       # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ class-gallery.php        # –ì–∞–ª–µ—Ä–µ—è
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trip-map.js          # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookings.js          # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gallery.js           # –ù–æ–≤—ã–π
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ trip-map.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ custom.css
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ       ‚îî‚îÄ‚îÄ markers/
‚îî‚îÄ‚îÄ languages/                    # –ü–µ—Ä–µ–≤–æ–¥—ã
```

---

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç—ã

#### v1.1.0 - –£–ª—É—á—à–µ–Ω–∏—è UX
- [ ] **Clustering –º–∞—Ä–∫–µ—Ä–æ–≤** –¥–ª—è >20 –ª–æ–∫–∞—Ü–∏–π (Leaflet.markercluster)
- [ ] **–ê–Ω–∏–º–∞—Ü–∏—è** –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ popup
- [ ] **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–∞–Ω–Ω—ã—Ö –≤ sessionStorage
- [ ] **–î–µ–±–∞—É–Ω—Å** –¥–ª—è –∫–ª–∏–∫–æ–≤ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)

#### v1.2.0 - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] **–†–∞–∑–Ω—ã–µ –∏–∫–æ–Ω–∫–∏** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ª–æ–∫–∞—Ü–∏–π
- [ ] **–ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ** –≤ popup –º–∞—Ä–∫–µ—Ä–∞ (–Ω–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Ñ–æ—Ç–æ)
- [ ] **–§–∏–ª—å—Ç—Ä—ã** –ª–æ–∫–∞—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] **–ü–æ–∏—Å–∫** –Ω–∞ –∫–∞—Ä—Ç–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ª–æ–∫–∞—Ü–∏–∏
- [ ] **–≠–∫—Å–ø–æ—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–∞** –≤ GPX/KML

#### v1.3.0 - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏
- [ ] **Mapbox** integration (–∫—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–∞—Ä—Ç—ã)
- [ ] **Elevation API** –¥–ª—è –≤—ã—Å–æ—Ç—ã –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è
- [ ] **Weather API** –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã –≤ –ª–æ–∫–∞—Ü–∏–∏
- [ ] **Routing** –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ (Leaflet Routing Machine)

#### v2.0.0 - Admin –ø–∞–Ω–µ–ª—å
- [ ] **Settings page** –≤ WordPress –∞–¥–º–∏–Ω–∫–µ
- [ ] –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –∫–∞—Ä—Ç—ã (OpenStreetMap / Mapbox / etc)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤ –∏ —Å—Ç–∏–ª–µ–π
- [ ] –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –ª–æ–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ CSV
- [ ] –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —á–µ—Ä–µ–∑ –≥–µ–æ–∫–æ–¥–µ—Ä

---

### –î—Ä—É–≥–∏–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ —Å–∞–π—Ç–∞ (–ø—Ä–∏–º–µ—Ä—ã)

#### 1. –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```php
// –í init_hooks():
add_action('wp_ajax_create_booking', array($this, 'create_booking'));
add_action('wp_ajax_nopriv_create_booking', array($this, 'create_booking'));

public function create_booking() {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ email
    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
    wp_send_json_success($booking_data);
}
```

#### 2. Live —á–∞—Ç —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
```php
// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Crisp / Intercom / Tawk.to
public function enqueue_chat_widget() {
    wp_enqueue_script('chat-widget', 'https://...');
}
```

#### 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤
```javascript
// assets/js/filters.js
jQuery('.filter-button').on('click', function() {
    const category = $(this).data('category');
    
    $.ajax({
        url: tripMapData.ajaxUrl,
        data: {
            action: 'filter_trips',
            category: category
        },
        success: function(response) {
            $('.trips-list').html(response.data);
        }
    });
});
```

#### 4. Newsletter subscription
```php
add_action('wp_ajax_subscribe_newsletter', array($this, 'subscribe_newsletter'));
add_action('wp_ajax_nopriv_subscribe_newsletter', array($this, 'subscribe_newsletter'));

public function subscribe_newsletter() {
    $email = sanitize_email($_POST['email']);
    
    // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MailChimp / SendGrid / etc
    // –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ë–î
    
    wp_send_json_success('Subscribed!');
}
```

---

## üìö –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–¢–ö–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 1. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å nonce
```php
if (!check_ajax_referer('trip_map_nonce', 'nonce', false)) {
    wp_send_json_error('Invalid nonce');
    return;
}
```

#### 2. –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```php
$trip_id = intval($_POST['trip_id']);  // –î–ª—è —á–∏—Å–µ–ª
$email = sanitize_email($_POST['email']);  // –î–ª—è email
$text = sanitize_text_field($_POST['text']);  // –î–ª—è —Ç–µ–∫—Å—Ç–∞
```

#### 3. Escape –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```javascript
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return String(text).replace(/[&<>"']/g, function(m) { return map[m]; });
}
```

---

### Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### 1. –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
```php
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .min –≤–µ—Ä—Å–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
$suffix = (defined('SCRIPT_DEBUG') && SCRIPT_DEBUG) ? '' : '.min';
wp_enqueue_script('kostaryka-trip-map', 
    KOSTARYKA_TRIP_MAP_PLUGIN_URL . 'assets/js/trip-map' . $suffix . '.js'
);
```

#### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤
```javascript
// –ü—Ä–æ—Å—Ç–æ–π –∫–µ—à –≤ –ø–∞–º—è—Ç–∏
const locationsCache = {};

function loadTripLocations(tripId) {
    if (locationsCache[tripId]) {
        console.log('Loading from cache');
        renderLocationsList(locationsCache[tripId]);
        initMap(locationsCache[tripId]);
        return;
    }
    
    $.ajax({
        // ... –∑–∞–ø—Ä–æ—Å
        success: function(response) {
            locationsCache[tripId] = response.data;
            // ... —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
        }
    });
}
```

#### 3. Lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```javascript
// –í renderLocationsList:
html += '<img src="placeholder.jpg" data-src="' + loc.image + '" class="lazy">';

// Intersection Observer
const lazyImages = document.querySelectorAll('img.lazy');
const imageObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imageObserver.unobserve(img);
        }
    });
});

lazyImages.forEach(img => imageObserver.observe(img));
```

---

### Debugging

#### 1. Debug mode –≤ –ø–ª–∞–≥–∏–Ω–µ
```php
// –í –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ –ø–ª–∞–≥–∏–Ω–∞ –¥–æ–±–∞–≤–∏—Ç—å:
define('KOSTARYKA_TRIP_MAP_DEBUG', true);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ:
if (KOSTARYKA_TRIP_MAP_DEBUG) {
    error_log('Trip Map Debug: ' . print_r($data, true));
}
```

#### 2. Console logging –≤ JS
```javascript
// URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º: ?debug_trip_map=1
if (window.location.search.indexOf('debug_trip_map=1') !== -1) {
    console.log('=== TRIP MAP DEBUG ===');
    console.log('tripMapData:', tripMapData);
    console.log('Leaflet version:', L.version);
    console.log('jQuery version:', jQuery.fn.jquery);
}
```

#### 3. AJAX Debug –≤ –∫–æ–Ω—Å–æ–ª–∏
```javascript
// –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ AJAX
$.ajax({
    // ... –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    beforeSend: function(xhr, settings) {
        console.log('AJAX Request:', settings.url, settings.data);
    },
    success: function(response, status, xhr) {
        console.log('AJAX Success:', response);
        console.log('Response Headers:', xhr.getAllResponseHeaders());
    },
    error: function(xhr, status, error) {
        console.error('AJAX Error:', error);
        console.error('Response Text:', xhr.responseText);
        console.error('Status:', xhr.status);
    }
});
```

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **Leaflet.js**: https://leafletjs.com/reference.html
- **OpenStreetMap**: https://wiki.openstreetmap.org/wiki/Tile_servers
- **WordPress AJAX**: https://developer.wordpress.org/plugins/javascript/ajax/
- **ACF**: https://www.advancedcustomfields.com/resources/

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ª–æ–∫–∞—Ü–∏–π**: https://www.google.com/maps (–ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí "Co tu jest?")
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API**: https://site.com/wp-json/wp/v2/oferta
- **–í–∞–ª–∏–¥–∞—Ç–æ—Ä coordinates**: https://www.latlong.net/

### –ò–∫–æ–Ω–∫–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
- **Flaticon**: https://www.flaticon.com/
- **Icons8**: https://icons8.com/icons/set/map-marker
- **Font Awesome**: https://fontawesome.com/icons?d=gallery&q=map

---

## üìù –ß–ï–ö–õ–ò–°–¢ –ü–†–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ò

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞:

- [ ] –°–¥–µ–ª–∞—Ç—å backup —Ñ–∞–π–ª–∞ –∫–æ—Ç–æ—Ä—ã–π –∏–∑–º–µ–Ω—è–µ—à—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–ª–∞–≥–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω
- [ ] –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫
- [ ] –ï—Å–ª–∏ –º–µ–Ω—è–µ—à—å PHP - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å PHP error log

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

- [ ] –û—á–∏—Å—Ç–∏—Ç—å cache –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ JavaScript
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network tab –Ω–∞ AJAX –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ—Å—Ç—ã —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ª–æ–∫–∞—Ü–∏–π

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å:

1. **–û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–≤–µ—Ä–Ω—É—Ç—å backup)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å** - —Ç–∞–º –æ–±—ã—á–Ω–æ —è—Å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–æ —á—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å PHP errors** –≤ `/wp-content/debug.log`
4. **–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å** –ø–ª–∞–≥–∏–Ω
5. **–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–µ—à–∏** (WP cache, browser cache, CDN –µ—Å–ª–∏ –µ—Å—Ç—å)

---

## üéì –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–≠—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω —è–≤–ª—è–µ—Ç—Å—è **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–æ–º** –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π —Å–∞–π—Ç–∞. –û–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É WordPress –ø–ª–∞–≥–∏–Ω–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å AJAX
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (Leaflet.js)
- ‚úÖ –†–∞–±–æ—Ç—É —Å ACF –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ Responsive design
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Breakdance builder

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:**
1. –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–º—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞)
2. –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
3. –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
4. –°–ª–µ–¥—É–µ—Ç WordPress coding standards
5. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π (nonce, sanitization, escaping)

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –ø—Ä–∏ —Ä–æ—Å—Ç–µ
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –°–æ–∑–¥–∞–Ω–∏–µ admin settings page –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞

---

**–ê–≤—Ç–æ—Ä**: Jauhien  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 25 —è–Ω–≤–∞—Ä—è 2025  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 25 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞**: 1.0.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
---

## üîÑ –¢–ï–ö–£–©–ê–Ø –ó–ê–î–ê–ß–ê: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ Vanilla JS

**–°—Ç–∞—Ç—É—Å**: üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ  
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: [–¥–æ–±–∞–≤—å –¥–∞—Ç—É]  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: Claude Code

### –¶–µ–ª—å
–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `/assets/js/trip-map.js` —Å jQuery –Ω–∞ —á–∏—Å—Ç—ã–π JavaScript (Vanilla JS) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ü–ª–∞–≥–∏–Ω **Kostaryka Trip Map** —Å–æ–∑–¥–∞–Ω –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã –ª–æ–∫–∞—Ü–∏–π –≤ Breakdance popup. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç jQuery, –Ω–æ WordPress –∑–∞–≥—Ä—É–∂–∞–µ—Ç jQuery –¥–∞–∂–µ —Ç–∞–º –≥–¥–µ –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Vanilla JS —É–º–µ–Ω—å—à–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å

#### –§–∞–π–ª: `/assets/js/trip-map.js`

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```javascript
(function($) {
    'use strict';
    
    let map = null;
    let markers = [];
    let markersLayer = null;

    $(document).ready(function() {
        initTripMapButtons();
    });
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Å jQuery
})(jQuery);
```

**–¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```javascript
(function() {
    'use strict';
    
    let map = null;
    let markers = [];
    let markersLayer = null;

    document.addEventListener('DOMContentLoaded', function() {
        initTripMapButtons();
    });
    
    // ... –≤–µ—Å—å –∫–æ–¥ –Ω–∞ Vanilla JS
})();
```

### –¢–∞–±–ª–∏—Ü–∞ –∑–∞–º–µ–Ω jQuery ‚Üí Vanilla JS

| jQuery | Vanilla JS | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|--------|-----------|-------------|
| `$(document).ready(fn)` | `document.addEventListener('DOMContentLoaded', fn)` | –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM |
| `$(selector)` | `document.querySelector(selector)` | –û–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç |
| `$(selector)` | `document.querySelectorAll(selector)` | –ù–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| `$(this)` | `this` –∏–ª–∏ `e.currentTarget` | –í event handler |
| `$el.on('click', fn)` | `el.addEventListener('click', fn)` | Event listener |
| `$(document).on('click', sel, fn)` | Event delegation (—Å–º. –Ω–∏–∂–µ) | –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `$el.closest(sel)` | `el.closest(sel)` | –ù–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ |
| `$el.find(sel)` | `el.querySelector(sel)` | –ü–æ–∏—Å–∫ –≤–Ω—É—Ç—Ä–∏ |
| `$el.attr('href')` | `el.getAttribute('href')` | –ü–æ–ª—É—á–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç |
| `$el.data('trip-id')` | `el.dataset.tripId` | Data –∞—Ç—Ä–∏–±—É—Ç—ã |
| `$el.html(html)` | `el.innerHTML = html` | –í—Å—Ç–∞–≤–∫–∞ HTML |
| `$el.addClass('active')` | `el.classList.add('active')` | –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å |
| `$el.removeClass('active')` | `el.classList.remove('active')` | –£–±—Ä–∞—Ç—å –∫–ª–∞—Å—Å |
| `$.ajax({...})` | `fetch(...).then(...)` | AJAX –∑–∞–ø—Ä–æ—Å—ã |

### Event Delegation (–≤–∞–∂–Ω–æ!)

**jQuery —Å–ø–æ—Å–æ–±:**
```javascript
$(document).on('click', '.trip-preview-btn', function(e) {
    e.preventDefault();
    const tripId = $(this).data('trip-id');
    // ...
});
```

**Vanilla JS —Å–ø–æ—Å–æ–±:**
```javascript
document.addEventListener('click', function(e) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–ª–∏–∫ –ø–æ –Ω—É–∂–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
    const button = e.target.closest('.trip-preview-btn');
    if (!button) return;
    
    e.preventDefault();
    const tripId = button.dataset.tripId;
    // ...
});
```

### AJAX: $.ajax() ‚Üí fetch()

**jQuery —Å–ø–æ—Å–æ–±:**
```javascript
$.ajax({
    url: tripMapData.ajaxUrl,
    type: 'POST',
    data: {
        action: 'get_trip_locations',
        trip_id: tripId,
        nonce: tripMapData.nonce
    },
    success: function(response) {
        console.log(response);
    },
    error: function(xhr, status, error) {
        console.error(error);
    }
});
```

**Vanilla JS —Å–ø–æ—Å–æ–± (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π async/await):**
```javascript
async function loadTripLocations(tripId) {
    try {
        // –°–æ–∑–¥–∞–µ–º FormData –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–∞
        const formData = new FormData();
        formData.append('action', 'get_trip_locations');
        formData.append('trip_id', tripId);
        formData.append('nonce', tripMapData.nonce);
        
        const response = await fetch(tripMapData.ajaxUrl, {
            method: 'POST',
            body: formData
        });
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        const data = await response.json();
        
        if (data.success) {
            console.log(data.data);
        } else {
            throw new Error(data.data);
        }
    } catch (error) {
        console.error('Error:', error);
        showError(error.message);
    }
}
```

### –í–∞–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è

#### 1. `initTripMapButtons()`
- –ó–∞–º–µ–Ω–∏—Ç—å event delegation —Å jQuery –Ω–∞ Vanilla

#### 2. `handleButtonClick(e)`
- –ó–∞–º–µ–Ω–∏—Ç—å `$(this)` –Ω–∞ `e.currentTarget` –∏–ª–∏ `e.target.closest()`
- –ó–∞–º–µ–Ω–∏—Ç—å `.closest()`, `.find()` –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- –ó–∞–º–µ–Ω–∏—Ç—å `.attr()` –Ω–∞ `.getAttribute()`

#### 3. `loadTripLocations(tripId)`
- –ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å `$.ajax()` –Ω–∞ `fetch()` + async/await
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ try/catch

#### 4. `renderLocationsList(locations)`
- –ó–∞–º–µ–Ω–∏—Ç—å `$('#locations-list').html(html)` –Ω–∞ `document.getElementById('locations-list').innerHTML = html`
- –ó–∞–º–µ–Ω–∏—Ç—å `$('.location-item').on('click', ...)` –Ω–∞ event delegation

#### 5. `showLoader()` –∏ `showError()`
- –ó–∞–º–µ–Ω–∏—Ç—å jQuery —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ

#### 6. `escapeHtml(text)`
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç jQuery)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ

1. **Event delegation** - –∫–ª–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
2. **Async/await** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è AJAX
3. **Error handling** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ try/catch –¥–ª—è –≤—Å–µ—Ö fetch –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –í–°–Æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª**: `/wp-content/plugins/kostaryka-trip-map/assets/js/trip-map.js`
2. **PHP —Ñ–∞–π–ª** (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è): `/wp-content/plugins/kostaryka-trip-map/kostaryka-trip-map.php`

–í PHP –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ:
```php
wp_enqueue_script('kostaryka-trip-map', 
    KOSTARYKA_TRIP_MAP_PLUGIN_URL . 'assets/js/trip-map.js',
    array(),  // ‚Üê –£–±—Ä–∞—Ç—å 'jquery' –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!
    KOSTARYKA_TRIP_MAP_VERSION,
    true
);
```

### –ß–µ–∫–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ jQuery —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –Ω–∞—Ç–∏–≤–Ω—ã–µ
- [ ] Event delegation —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] AJAX –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ fetch() —Å async/await
- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ jQuery
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
  - [ ] –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç popup
  - [ ] –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–π
  - [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π
  - [ ] –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
  - [ ] –ö–ª–∏–∫ –ø–æ –ª–æ–∫–∞—Ü–∏–∏ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É
  - [ ] –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç popup
- [ ] –£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç jQuery –≤ PHP
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ:**
- –†–∞–∑–º–µ—Ä: ~6KB
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: jQuery (30KB)
- –ò—Ç–æ–≥–æ: 36KB

**–ü–æ—Å–ª–µ:**
- –†–∞–∑–º–µ—Ä: ~4-5KB
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –Ω–µ—Ç
- –ò—Ç–æ–≥–æ: 4-5KB

**–í—ã–∏–≥—Ä—ã—à**: ~31KB –º–µ–Ω—å—à–µ –∑–∞–≥—Ä—É–∑–∫–∏

### –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **–≠—Ç–∞–ø—É 2: Lazy Loading**.
```
